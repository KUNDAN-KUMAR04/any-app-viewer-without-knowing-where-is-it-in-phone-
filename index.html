<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APK BYPASS - Open Android Apps Directly</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00ff88;
            --secondary: #ff4400;
            --accent: #00ccff;
            --warn: #ffcc00;
            --bg: #0a0a0a;
            --bg2: #111111;
            --bg3: #181818;
            --border: #2a2a2a;
            --text: #e8e8e8;
            --text2: #888;
            --card: #141414;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            line-height: 1.5;
            overflow-x: hidden;
        }
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px);
            pointer-events: none;
            z-index: 9999;
        }

        /* HEADER */
        header {
            background: #0d0d0d;
            border-bottom: 1px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 0 20px rgba(0,255,136,0.15);
        }
        .header-top {
            background: var(--primary);
            padding: 4px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-top span {
            font-family: 'Share Tech Mono', monospace;
            font-size: 11px;
            color: #000;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .logo {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
            text-decoration: none;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(0,255,136,0.4);
        }
        .logo span { color: var(--secondary); }
        .header-actions { display: flex; gap: 10px; align-items: center; }
        .device-badge {
            background: rgba(0,255,136,0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 5px 12px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
        }
        .btn-defaults {
            background: rgba(255,204,0,0.1);
            border: 1px solid var(--warn);
            color: var(--warn);
            padding: 5px 14px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 11px;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn-defaults:hover { background: rgba(255,204,0,0.2); }

        /* HERO */
        .hero {
            background: linear-gradient(180deg, #0d0d0d 0%, var(--bg) 100%);
            padding: 40px 20px 32px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: -50%; left: 50%;
            transform: translateX(-50%);
            width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(0,255,136,0.06) 0%, transparent 70%);
            pointer-events: none;
        }
        .hero-label {
            display: inline-block;
            background: var(--secondary);
            color: #fff;
            font-family: 'Share Tech Mono', monospace;
            font-size: 11px;
            padding: 4px 12px;
            letter-spacing: 2px;
            margin-bottom: 14px;
        }
        .hero h1 {
            font-family: 'Orbitron', monospace;
            font-size: clamp(1.6rem, 5vw, 2.6rem);
            font-weight: 900;
            color: var(--text);
            letter-spacing: 2px;
            margin-bottom: 10px;
            line-height: 1.1;
        }
        .hero h1 em { color: var(--primary); font-style: normal; text-shadow: 0 0 30px rgba(0,255,136,0.4); }
        .hero p {
            color: var(--text2);
            max-width: 540px;
            margin: 0 auto 26px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            line-height: 1.9;
        }
        .stats-bar { display: flex; justify-content: center; gap: 36px; flex-wrap: wrap; }
        .stat-num { font-family: 'Orbitron', monospace; font-size: 1.8rem; font-weight: 700; color: var(--primary); display: block; }
        .stat-label { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: var(--text2); letter-spacing: 1px; text-transform: uppercase; }

        /* CONTROLS */
        .controls {
            background: var(--bg2);
            border-bottom: 1px solid var(--border);
            padding: 14px 20px;
            position: sticky;
            top: 73px;
            z-index: 90;
        }
        .controls-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        .search-wrap { flex: 1; min-width: 200px; position: relative; }
        .search-wrap::before {
            content: 'âŒ•';
            position: absolute;
            left: 11px; top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 18px;
            pointer-events: none;
        }
        input[type="text"] {
            width: 100%;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Share Tech Mono', monospace;
            font-size: 13px;
            padding: 10px 14px 10px 34px;
            outline: none;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus { border-color: var(--primary); }
        input[type="text"]::placeholder { color: var(--text2); }
        select {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            padding: 10px 14px;
            outline: none;
            cursor: pointer;
        }

        /* DEVICE TABS */
        .device-tabs {
            padding: 14px 20px 0;
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        .dtab {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text2);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 13px;
            padding: 7px 14px;
            cursor: pointer;
            transition: all 0.15s;
            text-transform: uppercase;
        }
        .dtab:hover, .dtab.active { border-color: var(--primary); color: var(--primary); background: rgba(0,255,136,0.05); }

        /* MAIN */
        .main { max-width: 1400px; margin: 0 auto; padding: 24px 20px 60px; }

        /* =============================================
           QUICK LAUNCH CATEGORIES â€” USER'S DEFAULT APPS
           ============================================= */
        .quick-section {
            margin-bottom: 40px;
            background: var(--bg2);
            border: 1px solid var(--border);
            border-left: 3px solid var(--warn);
        }
        .quick-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            border-bottom: 1px solid var(--border);
        }
        .quick-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--warn);
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .quick-hint {
            font-family: 'Share Tech Mono', monospace;
            font-size: 10px;
            color: var(--text2);
            letter-spacing: 1px;
        }
        .quick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1px;
            background: var(--border);
        }
        .quick-card {
            background: var(--card);
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            position: relative;
        }
        .quick-cat-label {
            font-family: 'Share Tech Mono', monospace;
            font-size: 9px;
            color: var(--text2);
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        /* The main open link in quick card */
        .quick-card a.quick-open {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            transition: color 0.15s;
            min-height: 32px;
        }
        .quick-card a.quick-open:hover { color: var(--primary); }
        .quick-card a.quick-open .q-ico { font-size: 1.2rem; flex-shrink: 0; }
        .quick-card a.quick-open .q-name { flex: 1; line-height: 1.2; }
        .quick-card a.quick-open .q-arr { color: var(--primary); font-size: 0.8rem; opacity: 0; transition: opacity 0.15s; }
        .quick-card a.quick-open:hover .q-arr { opacity: 1; }
        .quick-card .change-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text2);
            font-family: 'Share Tech Mono', monospace;
            font-size: 9px;
            padding: 3px 8px;
            cursor: pointer;
            letter-spacing: 1px;
            text-align: left;
            transition: all 0.15s;
            width: fit-content;
        }
        .quick-card .change-btn:hover { border-color: var(--warn); color: var(--warn); }
        .not-set {
            font-family: 'Share Tech Mono', monospace;
            font-size: 10px;
            color: var(--text2);
            font-style: italic;
        }

        /* BRAND SECTION */
        .brand-section { margin-bottom: 36px; animation: fadeUp 0.35s ease both; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(14px); } to { opacity: 1; transform: translateY(0); } }
        .brand-heading {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            margin-bottom: 12px;
            border-bottom: 1px solid var(--border);
            position: relative;
        }
        .brand-heading::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 50px; height: 2px; background: var(--primary); }
        .brand-emoji { font-size: 1.5rem; }
        .brand-name { font-family: 'Orbitron', monospace; font-size: 0.95rem; font-weight: 700; color: var(--text); letter-spacing: 1px; text-transform: uppercase; }
        .brand-count { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: var(--text2); background: var(--bg3); padding: 2px 7px; border: 1px solid var(--border); margin-left: auto; }

        /* APP LIST */
        .app-list { list-style: none; display: flex; flex-direction: column; gap: 2px; }
        .app-list li { background: var(--card); border: 1px solid var(--border); transition: all 0.15s; }
        .app-list li:hover { border-color: rgba(0,255,136,0.35); background: #1a1a1a; }
        .app-list li.is-default { border-color: rgba(255,204,0,0.3); }
        .app-list li.is-default:hover { border-color: rgba(255,204,0,0.6); }

        /* MAIN LINK â€” intent://pkg/#Intent;scheme=android-app;end */
        .app-list li a.app-link {
            display: flex;
            align-items: center;
            gap: 11px;
            padding: 11px 14px;
            text-decoration: none;
            color: var(--text);
            transition: color 0.15s;
        }
        .app-list li a.app-link:hover { color: var(--primary); }
        .lbl-open { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; min-width: 32px; flex-shrink: 0; }
        .app-ico { font-size: 1.25rem; width: 26px; text-align: center; flex-shrink: 0; }
        .app-nm { font-family: 'Rajdhani', sans-serif; font-weight: 600; font-size: 1.05rem; flex: 1; }
        .app-pkg { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: var(--text2); display: none; }
        @media (min-width: 600px) { .app-pkg { display: block; } }
        .app-cat { font-family: 'Share Tech Mono', monospace; font-size: 10px; color: var(--accent); background: rgba(0,204,255,0.07); border: 1px solid rgba(0,204,255,0.2); padding: 2px 6px; text-transform: uppercase; letter-spacing: 0.5px; flex-shrink: 0; }
        .default-badge { font-family: 'Share Tech Mono', monospace; font-size: 9px; color: var(--warn); background: rgba(255,204,0,0.1); border: 1px solid rgba(255,204,0,0.3); padding: 2px 6px; letter-spacing: 0.5px; flex-shrink: 0; }
        .btn-set-default {
            background: none;
            border: 1px solid var(--border);
            color: var(--text2);
            font-family: 'Share Tech Mono', monospace;
            font-size: 9px;
            padding: 3px 8px;
            cursor: pointer;
            transition: all 0.15s;
            flex-shrink: 0;
            letter-spacing: 0.5px;
        }
        .btn-set-default:hover { border-color: var(--warn); color: var(--warn); }
        .btn-set-default.is-set { border-color: rgba(255,204,0,0.4); color: var(--warn); }
        .btn-copy { background: none; border: 1px solid var(--border); color: var(--text2); font-size: 11px; padding: 2px 7px; cursor: pointer; transition: all 0.15s; flex-shrink: 0; font-family: 'Share Tech Mono', monospace; }
        .btn-copy:hover { border-color: var(--accent); color: var(--accent); }
        .arr { color: var(--primary); font-size: 0.9rem; opacity: 0; transition: opacity 0.15s, transform 0.15s; flex-shrink: 0; }
        .app-list li a.app-link:hover .arr { opacity: 1; transform: translateX(3px); }

        /* SELECT DEFAULT MODAL */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.open { display: flex; }
        .modal {
            background: var(--bg2);
            border: 1px solid var(--warn);
            width: 100%;
            max-width: 520px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 40px rgba(255,204,0,0.15);
            animation: modalIn 0.2s ease;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.96); } to { opacity: 1; transform: scale(1); } }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            background: rgba(255,204,0,0.05);
        }
        .modal-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--warn);
            letter-spacing: 1px;
        }
        .modal-subtitle {
            font-family: 'Share Tech Mono', monospace;
            font-size: 10px;
            color: var(--text2);
            margin-top: 2px;
            letter-spacing: 0.5px;
        }
        .modal-close {
            background: none;
            border: 1px solid var(--border);
            color: var(--text2);
            font-size: 16px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            font-family: 'Share Tech Mono', monospace;
        }
        .modal-close:hover { border-color: var(--secondary); color: var(--secondary); }
        .modal-search {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }
        .modal-search input {
            width: 100%;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            padding: 8px 12px;
            outline: none;
        }
        .modal-search input:focus { border-color: var(--warn); }
        .modal-list { overflow-y: auto; flex: 1; }
        .modal-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.1s;
        }
        .modal-item:hover { background: rgba(255,204,0,0.05); }
        .modal-item.selected { background: rgba(255,204,0,0.08); border-left: 3px solid var(--warn); }
        .modal-item-ico { font-size: 1.2rem; flex-shrink: 0; }
        .modal-item-info { flex: 1; }
        .modal-item-name { font-family: 'Rajdhani', sans-serif; font-weight: 600; font-size: 1rem; color: var(--text); }
        .modal-item-pkg { font-family: 'Share Tech Mono', monospace; font-size: 9px; color: var(--text2); }
        .modal-item-brand { font-family: 'Share Tech Mono', monospace; font-size: 9px; color: var(--accent); }
        .modal-item-check { color: var(--warn); font-size: 1.1rem; }
        .modal-none { padding: 30px; text-align: center; font-family: 'Share Tech Mono', monospace; font-size: 12px; color: var(--text2); }

        /* EMPTY STATE */
        .empty-state { text-align: center; padding: 60px 20px; color: var(--text2); }
        .empty-state .ico { font-size: 3rem; margin-bottom: 12px; opacity: 0.3; }
        .empty-state p { font-family: 'Share Tech Mono', monospace; font-size: 12px; }

        /* TOAST */
        .toast {
            position: fixed;
            bottom: 24px; right: 20px;
            color: #000;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            font-weight: 700;
            padding: 9px 18px;
            z-index: 9000;
            animation: toastIn 0.25s ease;
            letter-spacing: 1px;
        }
        .toast.green { background: var(--primary); }
        .toast.yellow { background: var(--warn); }
        @keyframes toastIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

        /* FOOTER */
        footer { background: var(--bg2); border-top: 1px solid var(--border); padding: 18px 20px; text-align: center; font-family: 'Share Tech Mono', monospace; font-size: 11px; color: var(--text2); letter-spacing: 1px; }
        footer span { color: var(--primary); }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <span>â–¶ ANDROID APP DIRECT LAUNCH â€” CLICK TO OPEN ON DEVICE</span>
        <span id="deviceLabel">ðŸ“± DETECTING...</span>
    </div>
    <div class="header-main">
        <a href="#" class="logo">APK<span>.</span>BYPASS</a>
        <div class="header-actions">
            <button class="btn-defaults" onclick="openDefaultsModal()">âš™ SET DEFAULT APPS</button>
            <div class="device-badge" id="deviceBadge">ALL DEVICES</div>
        </div>
    </div>
</header>

<section class="hero">
    <div class="hero-label">â–¶ YOUR DEFAULTS â€” YOUR APPS â€” DIRECT OPEN</div>
    <h1>OPEN <em>YOUR</em><br>DEFAULT APPS</h1>
    <p>// set which phone, browser, files app you use<br>// then tap to open YOUR installed app directly</p>
    <div class="stats-bar">
        <div class="stat"><span class="stat-num" id="totalApps">0</span><span class="stat-label">Total Apps</span></div>
        <div class="stat"><span class="stat-num" id="totalBrands">0</span><span class="stat-label">Brands</span></div>
        <div class="stat"><span class="stat-num" id="defaultsSet">0</span><span class="stat-label">Defaults Set</span></div>
    </div>
</section>

<div class="controls">
    <div class="controls-inner">
        <div class="search-wrap">
            <input type="text" id="searchInput" placeholder="Search app name or package...">
        </div>
        <select id="categoryFilter">
            <option value="">All Categories</option>
            <option value="phone">Phone / Dialer</option>
            <option value="browser">Browser</option>
            <option value="files">Files / Manager</option>
            <option value="messages">Messages / SMS</option>
            <option value="camera">Camera</option>
            <option value="gallery">Gallery</option>
            <option value="launcher">Launcher</option>
            <option value="store">App Store</option>
            <option value="google">Google Apps</option>
            <option value="security">Security</option>
            <option value="utility">Utility</option>
            <option value="social">Social</option>
            <option value="health">Health</option>
            <option value="gaming">Gaming</option>
            <option value="system">System</option>
        </select>
    </div>
</div>

<div class="device-tabs" id="deviceTabs"></div>

<main class="main">
    <!-- Quick Launch â€” User's Defaults -->
    <div id="quickSection"></div>
    <!-- All Apps -->
    <div id="appSections"></div>
</main>

<!-- SET DEFAULT MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
    <div class="modal">
        <div class="modal-header">
            <div>
                <div class="modal-title" id="modalTitle">SELECT DEFAULT APP</div>
                <div class="modal-subtitle" id="modalSubtitle">Choose your preferred app for this category</div>
            </div>
            <button class="modal-close" onclick="closeModal()">âœ•</button>
        </div>
        <div class="modal-search">
            <input type="text" id="modalSearch" placeholder="Search apps..." oninput="renderModalList()">
        </div>
        <div class="modal-list" id="modalList"></div>
    </div>
</div>

<footer>
    <span>APK.BYPASS</span> // YOUR DEFAULT APP LAUNCHER // SET ONCE â€” OPEN ANYTIME
</footer>

<script>
// ============================================================
// APP DATABASE â€” All apps with proper categories
// ============================================================
const DB = {
    samsung: {
        name:"Samsung", emoji:"ðŸ¢",
        apps:[
            {name:"Galaxy Store",          pkg:"com.sec.android.app.samsungapps",           icon:"ðŸ›",  cat:"store",    dev:["samsung"]},
            {name:"Samsung My Files",       pkg:"com.sec.android.app.myfiles",               icon:"ðŸ“",  cat:"files",    dev:["samsung"]},
            {name:"Samsung Internet",       pkg:"com.sec.android.app.sbrowser",              icon:"ðŸŒ",  cat:"browser",  dev:["samsung"]},
            {name:"Samsung Health",         pkg:"com.sec.android.app.shealth",               icon:"â¤ï¸", cat:"health",   dev:["samsung"]},
            {name:"Samsung Members",        pkg:"com.samsung.memberservice",                  icon:"ðŸ‘¥",  cat:"system",   dev:["samsung"]},
            {name:"Samsung Pay",            pkg:"com.samsung.android.spay",                  icon:"ðŸ’³",  cat:"security", dev:["samsung"]},
            {name:"Samsung Pass",           pkg:"com.samsung.android.samsungpass",           icon:"ðŸ”",  cat:"security", dev:["samsung"]},
            {name:"SmartThings",            pkg:"com.samsung.android.beaconmanager",         icon:"ðŸ“¡",  cat:"utility",  dev:["samsung"]},
            {name:"Bixby Voice",            pkg:"com.svoice.service",                        icon:"ðŸŽ¤",  cat:"system",   dev:["samsung"]},
            {name:"Samsung Kids",           pkg:"com.sec.android.app.kidshome",              icon:"ðŸ‘¶",  cat:"system",   dev:["samsung"]},
            {name:"Samsung Notes",          pkg:"com.samsung.android.app.notes",             icon:"ðŸ“",  cat:"utility",  dev:["samsung"]},
            {name:"Samsung Secure Folder",  pkg:"com.samsung.knox.securefolder",             icon:"ðŸ”’",  cat:"security", dev:["samsung"]},
            {name:"Samsung Smart Switch",   pkg:"com.sec.android.easyMover",                icon:"â†”ï¸",  cat:"utility",  dev:["samsung"]},
            {name:"Samsung Dialer",         pkg:"com.samsung.android.dialer",               icon:"â˜Žï¸",  cat:"phone",    dev:["samsung"]},
            {name:"Samsung Messages",       pkg:"com.samsung.android.messaging",             icon:"ðŸ’¬",  cat:"messages", dev:["samsung"]},
            {name:"Samsung Camera",         pkg:"com.sec.android.app.camera",               icon:"ðŸ“·",  cat:"camera",   dev:["samsung"]},
            {name:"Samsung Gallery",        pkg:"com.sec.android.gallery3d",                icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["samsung"]},
            {name:"Samsung Home Launcher",  pkg:"com.sec.android.app.launcher",             icon:"ðŸ ",  cat:"launcher", dev:["samsung"]},
            {name:"Alliance Shield",        pkg:"com.rrivenllc.shieldx",                    icon:"ðŸ›¡ï¸",  cat:"security", dev:["samsung"]},
            {name:"Samsung Secure Folder",  pkg:"com.samsung.knox.securefolder",            icon:"ðŸ”’",  cat:"security", dev:["samsung"]},
        ]
    },
    google: {
        name:"Google", emoji:"ðŸ”µ",
        apps:[
            {name:"Gmail",                  pkg:"com.google.android.gm",                               icon:"ðŸ“§",  cat:"google",   dev:["all"]},
            {name:"Google Maps",            pkg:"com.google.android.apps.maps",                       icon:"ðŸ—ºï¸", cat:"google",   dev:["all"]},
            {name:"Google Drive",           pkg:"com.google.android.apps.docs",                       icon:"â˜ï¸",  cat:"google",   dev:["all"]},
            {name:"YouTube",                pkg:"com.google.android.youtube",                         icon:"â–¶ï¸",  cat:"google",   dev:["all"]},
            {name:"Google Photos",          pkg:"com.google.android.apps.photos",                     icon:"ðŸ“·",  cat:"gallery",  dev:["all"]},
            {name:"Google Keep",            pkg:"com.google.android.keep",                            icon:"ðŸ“Œ",  cat:"utility",  dev:["all"]},
            {name:"Google Calendar",        pkg:"com.google.android.calendar",                        icon:"ðŸ“…",  cat:"utility",  dev:["all"]},
            {name:"Google Meet",            pkg:"com.google.android.apps.meetings",                   icon:"ðŸ¤",  cat:"google",   dev:["all"]},
            {name:"Google Translate",       pkg:"com.google.android.apps.translate",                  icon:"ðŸŒ",  cat:"utility",  dev:["all"]},
            {name:"Google Authenticator",   pkg:"com.google.android.apps.authenticator2",             icon:"ðŸ”",  cat:"security", dev:["all"]},
            {name:"Google News",            pkg:"com.google.android.apps.news",                       icon:"ðŸ“°",  cat:"utility",  dev:["all"]},
            {name:"Google Play Games",      pkg:"com.google.android.play.games",                      icon:"ðŸŽ®",  cat:"gaming",   dev:["all"]},
            {name:"Google Assistant",       pkg:"com.google.android.apps.googleassistant",            icon:"ðŸ¤–",  cat:"google",   dev:["all"]},
            {name:"Quick Search Box",       pkg:"com.google.android.googlequicksearchbox",            icon:"ðŸ”",  cat:"google",   dev:["all"]},
            {name:"Login Google Account",   pkg:"com.google.android.gsf.login.LoginActivity",        icon:"ðŸ‘¤",  cat:"google",   dev:["all"]},
            {name:"Chrome Browser",         pkg:"com.android.chrome",                                 icon:"ðŸŒ",  cat:"browser",  dev:["all"]},
            {name:"Google Messages",        pkg:"com.google.android.apps.messaging",                  icon:"ðŸ’¬",  cat:"messages", dev:["all"]},
            {name:"Google Phone",           pkg:"com.google.android.dialer",                          icon:"ðŸ“ž",  cat:"phone",    dev:["all"]},
            {name:"Google Files",           pkg:"com.google.android.apps.nbu.files",                  icon:"ðŸ“",  cat:"files",    dev:["all"]},
            {name:"Google Camera",          pkg:"com.google.android.GoogleCamera",                    icon:"ðŸ“¸",  cat:"camera",   dev:["all"]},
        ]
    },
    android: {
        name:"Android System", emoji:"ðŸ¤–",
        apps:[
            {name:"Settings",               pkg:"com.android.settings",                 icon:"âš™ï¸",  cat:"system",   dev:["all"]},
            {name:"Files",                  pkg:"com.android.documentsui",               icon:"ðŸ“",  cat:"files",    dev:["all"]},
            {name:"Calculator",             pkg:"com.android.calculator2",               icon:"ðŸ”¢",  cat:"utility",  dev:["all"]},
            {name:"Clock",                  pkg:"com.android.deskclock",                 icon:"ðŸ•",  cat:"utility",  dev:["all"]},
            {name:"Phone (AOSP)",           pkg:"com.android.phone",                     icon:"ðŸ“ž",  cat:"phone",    dev:["all"]},
            {name:"Messages (AOSP)",        pkg:"com.android.messaging",                 icon:"ðŸ’¬",  cat:"messages", dev:["all"]},
            {name:"Contacts",               pkg:"com.android.contacts",                  icon:"ðŸ‘¥",  cat:"system",   dev:["all"]},
            {name:"Set Screen Lock",        pkg:"com.google.android.gms",               icon:"ðŸ”’",  cat:"security", dev:["all"], scheme:"promote_smartlock_scheme"},
            {name:"Accessibility",          pkg:"com.google.android.accessibility.switchaccess", icon:"â™¿", cat:"system", dev:["all"]},
            {name:"ADB Settings",           pkg:"com.sec.android.app.modemui.activities.usb.settings", icon:"ðŸ”Œ", cat:"system", dev:["all"]},
        ]
    },
    // POPULAR THIRD-PARTY APPS â€” works on any device
    popular: {
        name:"Popular Apps", emoji:"â­",
        apps:[
            // Phone / Dialer alternatives
            {name:"Truecaller",             pkg:"com.truecaller",                        icon:"ðŸ“ž",  cat:"phone",    dev:["all"]},
            {name:"Drupe Dialer",           pkg:"com.batutech.drupe",                    icon:"ðŸ“ž",  cat:"phone",    dev:["all"]},
            {name:"Phone by Google",        pkg:"com.google.android.dialer",             icon:"ðŸ“ž",  cat:"phone",    dev:["all"]},
            {name:"Duo (Video Call)",       pkg:"com.google.android.apps.tachyon",       icon:"ðŸ“¹",  cat:"phone",    dev:["all"]},
            // Browser alternatives
            {name:"Firefox Browser",        pkg:"org.mozilla.firefox",                   icon:"ðŸ¦Š",  cat:"browser",  dev:["all"]},
            {name:"Opera Browser",          pkg:"com.opera.browser",                     icon:"ðŸ”´",  cat:"browser",  dev:["all"]},
            {name:"Brave Browser",          pkg:"com.brave.browser",                     icon:"ðŸ¦",  cat:"browser",  dev:["all"]},
            {name:"UC Browser",             pkg:"com.UCMobile.intl",                     icon:"ðŸ”µ",  cat:"browser",  dev:["all"]},
            {name:"DuckDuckGo Browser",     pkg:"com.duckduckgo.mobile.android",         icon:"ðŸ¦†",  cat:"browser",  dev:["all"]},
            {name:"Kiwi Browser",           pkg:"com.kiwibrowser.browser",               icon:"ðŸ¥",  cat:"browser",  dev:["all"]},
            // SMS / Messages alternatives
            {name:"WhatsApp",               pkg:"com.whatsapp",                          icon:"ðŸ’š",  cat:"messages", dev:["all"]},
            {name:"Telegram",               pkg:"org.telegram.messenger",                icon:"âœˆï¸",  cat:"messages", dev:["all"]},
            {name:"Signal",                 pkg:"org.thoughtcrime.securesms",            icon:"ðŸ”µ",  cat:"messages", dev:["all"]},
            {name:"Pulse SMS",              pkg:"xyz.klinker.messenger",                 icon:"ðŸ’¬",  cat:"messages", dev:["all"]},
            {name:"QKSMS",                  pkg:"com.moez.QKSMS",                        icon:"ðŸ’¬",  cat:"messages", dev:["all"]},
            {name:"Chomp SMS",              pkg:"com.chompsms",                          icon:"ðŸ’¬",  cat:"messages", dev:["all"]},
            // File Managers
            {name:"ES File Explorer",       pkg:"com.estrongs.android.pop",              icon:"ðŸ“‚",  cat:"files",    dev:["all"]},
            {name:"Solid Explorer",         pkg:"pl.solidexplorer2",                     icon:"ðŸ“‚",  cat:"files",    dev:["all"]},
            {name:"MiXplorer",              pkg:"com.mixplorer",                         icon:"ðŸ“‚",  cat:"files",    dev:["all"]},
            {name:"FX File Explorer",       pkg:"nextapp.fx",                            icon:"ðŸ“‚",  cat:"files",    dev:["all"]},
            {name:"CX File Explorer",       pkg:"com.cxinventor.file.explorer",          icon:"ðŸ“‚",  cat:"files",    dev:["all"]},
            {name:"File Commander",         pkg:"com.mobisystems.fileman",               icon:"ðŸ“‚",  cat:"files",    dev:["all"]},
            {name:"Astro File Manager",     pkg:"com.metago.astro",                      icon:"ðŸ“‚",  cat:"files",    dev:["all"]},
            // Gallery alternatives
            {name:"Simple Gallery",         pkg:"com.simplemobiletools.gallery.pro",     icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["all"]},
            {name:"QuickPic Gallery",       pkg:"com.alensw.PicFolder",                  icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["all"]},
            // Launchers
            {name:"Nova Launcher",          pkg:"com.teslacoilsw.launcher",              icon:"ðŸš€",  cat:"launcher", dev:["all"]},
            {name:"Apex Launcher",          pkg:"com.anddoes.launcher",                  icon:"ðŸ”º",  cat:"launcher", dev:["all"]},
            {name:"Microsoft Launcher",     pkg:"com.microsoft.launcher",                icon:"ðŸªŸ",  cat:"launcher", dev:["all"]},
            {name:"Niagara Launcher",       pkg:"bitpit.launcher",                       icon:"âš¡",  cat:"launcher", dev:["all"]},
            {name:"Poco Launcher",          pkg:"com.mi.android.launcher",               icon:"âš¡",  cat:"launcher", dev:["all"]},
            {name:"One UI Home",            pkg:"com.sec.android.app.launcher",          icon:"ðŸ ",  cat:"launcher", dev:["all"]},
            // Camera alternatives
            {name:"Open Camera",            pkg:"net.sourceforge.opencamera",            icon:"ðŸ“·",  cat:"camera",   dev:["all"]},
            {name:"Camera FV-5",            pkg:"com.flavionet.android.camera.pro",      icon:"ðŸ“·",  cat:"camera",   dev:["all"]},
            // Social
            {name:"Instagram",              pkg:"com.instagram.android",                 icon:"ðŸ“¸",  cat:"social",   dev:["all"]},
            {name:"Facebook",               pkg:"com.facebook.katana",                   icon:"ðŸ‘",  cat:"social",   dev:["all"]},
            {name:"Twitter / X",            pkg:"com.twitter.android",                   icon:"ðŸ¦",  cat:"social",   dev:["all"]},
            {name:"TikTok",                 pkg:"com.zhiliaoapp.musically",              icon:"ðŸŽµ",  cat:"social",   dev:["all"]},
            {name:"Snapchat",               pkg:"com.snapchat.android",                  icon:"ðŸ‘»",  cat:"social",   dev:["all"]},
        ]
    },
    oneplus: {
        name:"OnePlus", emoji:"âš™ï¸",
        apps:[
            {name:"OnePlus Camera",         pkg:"com.oneplus.camera",        icon:"ðŸ“·",  cat:"camera",   dev:["oneplus"]},
            {name:"OnePlus Gallery",        pkg:"com.oneplus.gallery",       icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["oneplus"]},
            {name:"OnePlus File Manager",   pkg:"com.oneplus.filemanager",   icon:"ðŸ“‚",  cat:"files",    dev:["oneplus"]},
            {name:"Clone Phone",            pkg:"com.oneplus.backuprestore", icon:"ðŸ“±",  cat:"utility",  dev:["oneplus"]},
            {name:"OnePlus Notes",          pkg:"com.oneplus.notes",         icon:"ðŸ“",  cat:"utility",  dev:["oneplus"]},
            {name:"OnePlus Community",      pkg:"com.oneplus.community",     icon:"ðŸ‘¥",  cat:"social",   dev:["oneplus"]},
            {name:"OnePlus Health",         pkg:"com.oneplus.health",        icon:"â¤ï¸", cat:"health",   dev:["oneplus"]},
            {name:"OnePlus Launcher",       pkg:"com.oneplus.launcher",      icon:"âŒ‚",   cat:"launcher", dev:["oneplus"]},
            {name:"OnePlus Phone",          pkg:"com.oneplus.telephony",     icon:"ðŸ“ž",  cat:"phone",    dev:["oneplus"]},
            {name:"OnePlus Messages",       pkg:"com.oneplus.messaging",     icon:"ðŸ’¬",  cat:"messages", dev:["oneplus"]},
        ]
    },
    xiaomi: {
        name:"Xiaomi", emoji:"ðŸ”´",
        apps:[
            {name:"Mi File Manager",        pkg:"com.mi.android.globalFileexplorer",  icon:"ðŸ“‚",  cat:"files",    dev:["xiaomi"]},
            {name:"Xiaomi App Store",       pkg:"com.xiaomi.mipicks",                 icon:"ðŸ›",  cat:"store",    dev:["xiaomi"]},
            {name:"MIUI Gallery",           pkg:"com.miui.gallery",                   icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["xiaomi"]},
            {name:"MIUI Launcher",          pkg:"com.miui.launcher",                  icon:"âŒ‚",   cat:"launcher", dev:["xiaomi"]},
            {name:"Xiaomi ShareMe",         pkg:"com.xiaomi.midrop",                  icon:"âš¡",  cat:"utility",  dev:["xiaomi"]},
            {name:"Mi Home",                pkg:"com.xiaomi.smarthome",               icon:"ðŸ ",  cat:"utility",  dev:["xiaomi"]},
            {name:"Mi Mover",               pkg:"com.xiaomi.mover",                   icon:"â†”ï¸",  cat:"utility",  dev:["xiaomi"]},
            {name:"MIUI Camera",            pkg:"com.android.camera",                 icon:"ðŸ“·",  cat:"camera",   dev:["xiaomi"]},
            {name:"MIUI Phone",             pkg:"com.android.incallui",               icon:"ðŸ“ž",  cat:"phone",    dev:["xiaomi"]},
            {name:"MIUI Messages",          pkg:"com.android.mms",                    icon:"ðŸ’¬",  cat:"messages", dev:["xiaomi"]},
        ]
    },
    oppo: {
        name:"OPPO", emoji:"ðŸŸ¢",
        apps:[
            {name:"OPPO App Store",         pkg:"com.heytap.app",            icon:"ðŸ›",  cat:"store",    dev:["oppo"]},
            {name:"OPPO Camera",            pkg:"com.coloros.camera",         icon:"ðŸ“·",  cat:"camera",   dev:["oppo"]},
            {name:"OPPO Gallery",           pkg:"com.coloros.gallery",        icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["oppo"]},
            {name:"OPPO File Manager",      pkg:"com.oplus.filemanager",      icon:"ðŸ“‚",  cat:"files",    dev:["oppo"]},
            {name:"OPPO Launcher",          pkg:"com.coloros.launcher",       icon:"âŒ‚",   cat:"launcher", dev:["oppo"]},
            {name:"Phone Clone",            pkg:"com.coloros.backuprestore",  icon:"ðŸ“±",  cat:"utility",  dev:["oppo"]},
            {name:"OPPO Phone",             pkg:"com.coloros.dialer",         icon:"ðŸ“ž",  cat:"phone",    dev:["oppo"]},
            {name:"OPPO Messages",          pkg:"com.coloros.mms",            icon:"ðŸ’¬",  cat:"messages", dev:["oppo"]},
        ]
    },
    vivo: {
        name:"Vivo", emoji:"ðŸ’™",
        apps:[
            {name:"Vivo App Store",         pkg:"com.vivo.appstore",   icon:"ðŸ›",  cat:"store",    dev:["vivo"]},
            {name:"Vivo Camera",            pkg:"com.vivo.camera",     icon:"ðŸ“·",  cat:"camera",   dev:["vivo"]},
            {name:"Vivo Gallery",           pkg:"com.vivo.gallery",    icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["vivo"]},
            {name:"Vivo File Manager",      pkg:"com.vivo.filemanager",icon:"ðŸ“‚",  cat:"files",    dev:["vivo"]},
            {name:"Vivo Launcher",          pkg:"com.vivo.launcher",   icon:"âŒ‚",   cat:"launcher", dev:["vivo"]},
            {name:"Vivo EasyShare",         pkg:"com.vivo.easyshare",  icon:"âš¡",  cat:"utility",  dev:["vivo"]},
            {name:"Vivo Phone",             pkg:"com.vivo.dialer",     icon:"ðŸ“ž",  cat:"phone",    dev:["vivo"]},
            {name:"Vivo Messages",          pkg:"com.vivo.mms",        icon:"ðŸ’¬",  cat:"messages", dev:["vivo"]},
        ]
    },
    motorola: {
        name:"Motorola", emoji:"â“‚ï¸",
        apps:[
            {name:"Motorola Moto",          pkg:"com.motorola.moto",                icon:"ðŸ“±",  cat:"system",   dev:["motorola"]},
            {name:"Moto Secure",            pkg:"com.motorola.securityhub",          icon:"ðŸ”’",  cat:"security", dev:["motorola"]},
            {name:"Motorola Launcher",      pkg:"com.motorola.launcher3",            icon:"âŒ‚",   cat:"launcher", dev:["motorola"]},
            {name:"Motorola Camera",        pkg:"com.motorola.camera",               icon:"ðŸ“·",  cat:"camera",   dev:["motorola"]},
            {name:"Motorola Dialer",        pkg:"com.motorola.dialer",               icon:"ðŸ“ž",  cat:"phone",    dev:["motorola"]},
            {name:"Motorola Messages",      pkg:"com.motorola.messaging",            icon:"ðŸ’¬",  cat:"messages", dev:["motorola"]},
        ]
    },
    asus: {
        name:"ASUS", emoji:"â¬†ï¸",
        apps:[
            {name:"ASUS Phone Clone",       pkg:"com.futuredial.asusdatatransfer",  icon:"ðŸ“±",  cat:"utility",  dev:["asus"]},
            {name:"ASUS Camera",            pkg:"com.asus.camera",                  icon:"ðŸ“·",  cat:"camera",   dev:["asus"]},
            {name:"ASUS Gallery",           pkg:"com.asus.gallery",                 icon:"ðŸ–¼ï¸", cat:"gallery",  dev:["asus"]},
            {name:"ASUS File Manager",      pkg:"com.asus.filemanager",             icon:"ðŸ“‚",  cat:"files",    dev:["asus"]},
            {name:"ASUS Launcher",          pkg:"com.asus.launcher",                icon:"âŒ‚",   cat:"launcher", dev:["asus"]},
            {name:"ASUS Phone",             pkg:"com.asus.contacts",                icon:"ðŸ“ž",  cat:"phone",    dev:["asus"]},
        ]
    }
};

// All apps flat list
const ALL_APPS = [];
Object.entries(DB).forEach(([brand, b]) => {
    b.apps.forEach(a => ALL_APPS.push({...a, brand, brandName: b.name, brandEmoji: b.emoji}));
});

// Default categories users can set
const DEFAULT_CATS = [
    { cat: 'phone',    label: 'Phone / Dialer', icon: 'ðŸ“ž', hint: 'e.g. Truecaller, Samsung Dialer, Google Phone' },
    { cat: 'messages', label: 'SMS / Messages',  icon: 'ðŸ’¬', hint: 'e.g. WhatsApp, Google Messages, Samsung Messages' },
    { cat: 'browser',  label: 'Browser',         icon: 'ðŸŒ', hint: 'e.g. Chrome, Firefox, Samsung Internet' },
    { cat: 'files',    label: 'File Manager',    icon: 'ðŸ“', hint: 'e.g. Samsung My Files, ES Explorer, Solid Explorer' },
    { cat: 'camera',   label: 'Camera',          icon: 'ðŸ“·', hint: 'e.g. Samsung Camera, MIUI Camera, Open Camera' },
    { cat: 'gallery',  label: 'Gallery',         icon: 'ðŸ–¼ï¸', hint: 'e.g. Samsung Gallery, Google Photos, Simple Gallery' },
    { cat: 'launcher', label: 'Launcher',        icon: 'ðŸ ', hint: 'e.g. Nova Launcher, Samsung Home, MIUI Launcher' },
    { cat: 'store',    label: 'App Store',       icon: 'ðŸ›’', hint: 'e.g. Galaxy Store, Xiaomi Store, OPPO Store' },
];

// ============================================================
// STORAGE â€” user's default app choices (localStorage)
// ============================================================
const STORAGE_KEY = 'apkBypassDefaults';

function loadDefaults() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); }
    catch { return {}; }
}

function saveDefault(cat, appPkg) {
    const d = loadDefaults();
    d[cat] = appPkg;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
}

function getDefaultApp(cat) {
    const d = loadDefaults();
    if (!d[cat]) return null;
    return ALL_APPS.find(a => a.pkg === d[cat]) || null;
}

// ============================================================
// INTENT URL â€” exact entertechpro.com method
// ============================================================
function intentUrl(app) {
    if (app.url) return app.url;
    const scheme = app.scheme || 'android-app';
    return `intent://${app.pkg}/#Intent;scheme=${scheme};end`;
}

// ============================================================
// DEVICE DETECTION
// ============================================================
let currentDevice = 'all';

function detectDevice() {
    const ua = navigator.userAgent;
    if (/SM-|Samsung/i.test(ua)) return 'samsung';
    if (/Pixel|Nexus/i.test(ua)) return 'google';
    if (/OnePlus|ONEPLUS/i.test(ua)) return 'oneplus';
    if (/xiaomi|MI |Redmi|POCO/i.test(ua)) return 'xiaomi';
    if (/OPPO|CPH[0-9]/i.test(ua)) return 'oppo';
    if (/vivo/i.test(ua)) return 'vivo';
    if (/Motorola|MOTO|XT[0-9]/i.test(ua)) return 'motorola';
    if (/ASUS/i.test(ua)) return 'asus';
    return 'all';
}

// ============================================================
// QUICK LAUNCH SECTION â€” user's selected defaults
// ============================================================
function renderQuickSection() {
    const container = document.getElementById('quickSection');
    const defaults = loadDefaults();
    const setCount = Object.keys(defaults).length;

    document.getElementById('defaultsSet').textContent = setCount;

    const cards = DEFAULT_CATS.map(dc => {
        const app = getDefaultApp(dc.cat);
        const url = app ? intentUrl(app) : '#';
        const openPart = app
            ? `<a class="quick-open" href="${url}" target="_blank" rel="noopener">
                    <span class="q-ico">${app.icon}</span>
                    <span class="q-name">${app.name}</span>
                    <span class="q-arr">â†’</span>
               </a>`
            : `<div class="not-set">// not set</div>`;

        return `<div class="quick-card">
            <span class="quick-cat-label">${dc.icon} ${dc.label}</span>
            ${openPart}
            <button class="change-btn" onclick="openCatModal('${dc.cat}','${dc.label}','${dc.hint}')">
                ${app ? 'â‡„ CHANGE' : '+ SET DEFAULT'}
            </button>
        </div>`;
    }).join('');

    container.innerHTML = `
        <div class="quick-section">
            <div class="quick-header">
                <div>
                    <div class="quick-title">âš¡ YOUR DEFAULT APPS â€” QUICK LAUNCH</div>
                    <div class="quick-hint">// click any card to open your chosen app directly â€” tap "CHANGE" to pick a different one</div>
                </div>
                <span class="quick-hint">${setCount}/${DEFAULT_CATS.length} SET</span>
            </div>
            <div class="quick-grid">${cards}</div>
        </div>`;
}

// ============================================================
// TABS
// ============================================================
function renderTabs() {
    const el = document.getElementById('deviceTabs');
    const tabs = [{key:'all', name:'All', emoji:'ðŸ“±'}];
    Object.entries(DB).forEach(([k,b]) => tabs.push({key:k, name:b.name, emoji:b.emoji}));
    el.innerHTML = tabs.map(t =>
        `<button class="dtab${currentDevice===t.key?' active':''}" onclick="setDevice('${t.key}')">${t.emoji} ${t.name}</button>`
    ).join('');
}

function setDevice(d) { currentDevice = d; renderTabs(); renderApps(); }

// ============================================================
// RENDER ALL APPS
// ============================================================
function renderApps() {
    const container = document.getElementById('appSections');
    container.innerHTML = '';
    const q = document.getElementById('searchInput').value.toLowerCase();
    const cat = document.getElementById('categoryFilter').value;
    const defaults = loadDefaults();
    let total = 0;

    Object.entries(DB).forEach(([key, brand]) => {
        const apps = brand.apps.filter(a => {
            const ms = a.name.toLowerCase().includes(q) || a.pkg.toLowerCase().includes(q);
            const mc = !cat || a.cat === cat;
            const md = currentDevice === 'all' || a.dev.includes(currentDevice) || a.dev.includes('all');
            return ms && mc && md;
        });
        if (!apps.length) return;
        total += apps.length;

        // Sort: defaults first
        apps.sort((a, b) => {
            const aIsDefault = Object.values(defaults).includes(a.pkg);
            const bIsDefault = Object.values(defaults).includes(b.pkg);
            return bIsDefault - aIsDefault;
        });

        const items = apps.map(a => {
            const isDefault = Object.values(defaults).includes(a.pkg);
            const isCatDefault = defaults[a.cat] === a.pkg;
            const href = intentUrl(a);
            return `<li class="${isDefault ? 'is-default' : ''}">
                <a class="app-link" href="${href}" target="_blank" rel="noopener">
                    <span class="lbl-open">Open</span>
                    <span class="app-ico">${a.icon}</span>
                    <strong class="app-nm">${a.name}</strong>
                    <span class="app-pkg">${a.pkg}</span>
                    <span class="app-cat">${a.cat}</span>
                    ${isCatDefault ? `<span class="default-badge">â˜… DEFAULT</span>` : ''}
                    <button class="btn-set-default ${isCatDefault ? 'is-set' : ''}"
                        onclick="event.preventDefault();event.stopPropagation();quickSetDefault('${a.cat}','${a.pkg}','${a.name}')">
                        ${isCatDefault ? 'â˜… DEFAULT' : 'â˜† SET DEFAULT'}
                    </button>
                    <button class="btn-copy" onclick="event.preventDefault();event.stopPropagation();doCopy('${a.pkg}')">ðŸ“‹</button>
                    <span class="arr">â†’</span>
                </a>
            </li>`;
        }).join('');

        const sec = document.createElement('div');
        sec.className = 'brand-section';
        sec.innerHTML = `
            <div class="brand-heading">
                <span class="brand-emoji">${brand.emoji}</span>
                <span class="brand-name">${brand.name}</span>
                <span class="brand-count">${apps.length} APPS</span>
            </div>
            <ul class="app-list">${items}</ul>`;
        container.appendChild(sec);
    });

    if (!total) {
        container.innerHTML = `<div class="empty-state"><div class="ico">ðŸ”</div><p>// NO APPS FOUND</p></div>`;
    }
}

// ============================================================
// MODAL â€” pick default for a category
// ============================================================
let currentModalCat = '';

function openCatModal(cat, label, hint) {
    currentModalCat = cat;
    document.getElementById('modalTitle').textContent = `SET DEFAULT: ${label.toUpperCase()}`;
    document.getElementById('modalSubtitle').textContent = hint;
    document.getElementById('modalSearch').value = '';
    document.getElementById('modalOverlay').classList.add('open');
    renderModalList();
}

function openDefaultsModal() {
    // Open modal for first unset category, or phone
    const defaults = loadDefaults();
    const unset = DEFAULT_CATS.find(dc => !defaults[dc.cat]);
    const dc = unset || DEFAULT_CATS[0];
    openCatModal(dc.cat, dc.label, dc.hint);
}

function closeModal() {
    document.getElementById('modalOverlay').classList.remove('open');
    currentModalCat = '';
}

function renderModalList() {
    const q = document.getElementById('modalSearch').value.toLowerCase();
    const container = document.getElementById('modalList');
    const defaults = loadDefaults();
    const currentPkg = defaults[currentModalCat] || '';

    // Get all apps matching category, optionally filtered by search
    let apps = ALL_APPS.filter(a => {
        const matchCat = a.cat === currentModalCat;
        const matchSearch = !q || a.name.toLowerCase().includes(q) || a.pkg.toLowerCase().includes(q) || a.brandName.toLowerCase().includes(q);
        return matchCat && matchSearch;
    });

    // If searching, also show apps from other categories matching the search
    if (q && apps.length < 5) {
        const extra = ALL_APPS.filter(a => a.cat !== currentModalCat && (
            a.name.toLowerCase().includes(q) || a.pkg.toLowerCase().includes(q)
        )).slice(0, 10);
        apps = [...apps, ...extra];
    }

    if (!apps.length) {
        container.innerHTML = `<div class="modal-none">// No apps found for "${q}"<br>Try a different search term</div>`;
        return;
    }

    // Sort: current default first
    apps.sort((a, b) => (b.pkg === currentPkg) - (a.pkg === currentPkg));

    container.innerHTML = apps.map(a => `
        <div class="modal-item ${a.pkg === currentPkg ? 'selected' : ''}" onclick="selectDefault('${a.pkg}')">
            <span class="modal-item-ico">${a.icon}</span>
            <div class="modal-item-info">
                <div class="modal-item-name">${a.name}</div>
                <div class="modal-item-pkg">${a.pkg}</div>
                <div class="modal-item-brand">${a.brandEmoji} ${a.brandName}</div>
            </div>
            ${a.pkg === currentPkg ? '<span class="modal-item-check">â˜…</span>' : ''}
        </div>
    `).join('');
}

function selectDefault(pkg) {
    if (!currentModalCat) return;
    saveDefault(currentModalCat, pkg);
    const app = ALL_APPS.find(a => a.pkg === pkg);
    closeModal();
    renderQuickSection();
    renderApps();
    showToast(`â˜… DEFAULT SET: ${app ? app.name : pkg}`, 'yellow');
}

// Quick set default from app list (without opening modal)
function quickSetDefault(cat, pkg, name) {
    const defaults = loadDefaults();
    if (defaults[cat] === pkg) {
        // Already default â€” unset it
        delete defaults[cat];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(defaults));
        showToast(`// REMOVED DEFAULT: ${name}`, 'green');
    } else {
        saveDefault(cat, pkg);
        showToast(`â˜… DEFAULT SET: ${name}`, 'yellow');
    }
    renderQuickSection();
    renderApps();
}

// ============================================================
// STATS
// ============================================================
function updateStats() {
    let t = 0;
    Object.values(DB).forEach(b => t += b.apps.length);
    document.getElementById('totalApps').textContent = t;
    document.getElementById('totalBrands').textContent = Object.keys(DB).length;
}

// ============================================================
// COPY
// ============================================================
function doCopy(pkg) {
    navigator.clipboard.writeText(pkg).then(() => showToast('// COPIED: ' + pkg, 'green'));
}

// ============================================================
// TOAST
// ============================================================
function showToast(msg, type = 'green') {
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.textContent = msg;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 2800);
}

// ============================================================
// INIT
// ============================================================
document.addEventListener('DOMContentLoaded', () => {
    currentDevice = detectDevice();
    const d = currentDevice !== 'all' ? DB[currentDevice] : null;
    document.getElementById('deviceLabel').textContent = d ? `${d.emoji} ${d.name.toUpperCase()} DETECTED` : 'ðŸ“± ANDROID DEVICE';
    document.getElementById('deviceBadge').textContent = d ? d.name.toUpperCase() : 'ALL DEVICES';

    renderQuickSection();
    renderTabs();
    renderApps();
    updateStats();

    document.getElementById('searchInput').addEventListener('input', renderApps);
    document.getElementById('categoryFilter').addEventListener('change', renderApps);
});
</script>
</body>
</html>
